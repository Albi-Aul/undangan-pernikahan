<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Undangan Pernikahan Albi & Aul</title>

  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <meta property="og:title" content="Undangan Pernikahan Albi & Aul üíç" />
  <meta property="og:description" content="Dengan penuh cinta kami mengundang Anda untuk hadir di hari bahagia kami. Klik untuk membuka undangan." />
  <meta property="og:image" content="https://albi-aul.github.io/undangan-pernikahan/cover.jpg" />
  <meta property="og:url" content="https://albi-aul.github.io/undangan-pernikahan/" />
  <meta property="og:type" content="website" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --accent:#2f8f6f;
      --accent-dark:#265f4f;
      --white:#ffffff;
      --muted:#6b6b6b;
      --glass: rgba(255,255,255,0.18);
      --round:16px;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    html{
        scroll-behavior: smooth;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#fff;color:#111;-webkit-font-smoothing:antialiased}
    button{font-family:inherit}

    /* COVER */
    .cover{
      position:fixed;inset:0;
      background: center/cover no-repeat url('cover.jpg');
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;padding:28px;
      background-color:rgba(0,0,0,0.35);background-blend-mode:overlay;
      transition:opacity .6s ease;
      color:var(--white);
      z-index: 100; /* Ensure cover is on top initially */
    }
    .cover h1{font-family:'Great Vibes',cursive;font-size:3.2rem;margin:0 0 6px;text-shadow:0 3px 12px rgba(0,0,0,.55)}
    .cover h2{font-size:1.1rem;margin:0 0 8px;text-transform:none;letter-spacing:1px;text-shadow:0 2px 8px rgba(0,0,0,.45)}
    #guestName {
      margin-top:8px;margin-bottom:14px;font-size:1.02rem;font-style:italic;color:var(--white);
      text-shadow:0 2px 10px rgba(0,0,0,.7);
    }
    #countdown {
      display:inline-block;padding:8px 18px;border-radius:999px;background:rgba(255,255,255,0.14);
      backdrop-filter: blur(6px); color:var(--white);font-weight:600;margin-bottom:18px;box-shadow:0 6px 20px rgba(0,0,0,.25)
    }
    .cover .btn {
      margin:8px 6px;padding:10px 24px;border-radius:999px;border:2px solid rgba(255,255,255,.98);
      background:transparent;color:var(--white);font-weight:700;cursor:pointer;min-width:160px;
      transition:all .28s ease;
    }
    .cover .btn:hover{background:var(--white);color:var(--accent)}

    /* VIDEO PAGE */
    .video-page{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;background:#000;padding:20px;
      z-index: 90;
    }
    .video-frame{
      width:min(1100px,92%);max-height:82vh;border-radius:18px;overflow:hidden;
      box-shadow:0 18px 48px rgba(0,0,0,.45);background:#000;padding:6px;
      display:flex;align-items:center;justify-content:center;
    }
    video#weddingVideo{
      width:100%;height:auto;display:block;border-radius:12px;object-fit:contain;background:#000;
    }
    .video-controls{
      margin-top:14px;display:flex;gap:12px;align-items:center;justify-content:center;
    }
    .video-controls button{
      padding:10px 18px;border-radius:999px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;
      min-width:110px;
    }
    .video-controls button.secondary{background:transparent;color:var(--accent);border:2px solid var(--accent)}

    /* THANK YOU / COMBINED PAGE (Scrollable) */
    .thanks-page{
      position:fixed;inset:0;
      display:none;
      flex-direction:column; /* Allows content to flow top-down */
      padding:28px;
      background: center/cover no-repeat url('prewed2.jpeg');
      background-blend-mode:overlay;background-color:rgba(255,255,255,0.75);backdrop-filter:blur(8px);
      text-align:center;color:var(--accent-dark);
      overflow-y:auto; /* Allow scrolling for content */
      z-index: 80;
    }
    .thanks-inner{
      max-width:920px;
      padding:22px;
      border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(245,255,250,0.75));
      box-shadow:0 12px 40px rgba(16,35,22,0.06);
      /* Center horizontally and remove vertical constraint */
      margin: 0 auto; 
    }
    .thanks-inner h1{font-family:'Great Vibes',cursive;font-size:3rem;margin:6px 0 6px;color:var(--accent-dark)}
    .thanks-inner p{font-size:1.05rem;color:#2b3a37;margin:10px 0 18px}
    
    /* KADO DIGITAL STYLES */
    .kado{
        font-size: 1.5rem; 
        font-weight: 600; 
        margin-bottom: 20px; 
        color: var(--accent-dark); 
    }
    .dana-container{
        display:flex;
        flex-direction:column; 
        align-items:center;
        gap:8px; 
        margin-bottom:24px;
        padding: 16px 0; 
        font-size: 1.1rem;
        color: #333;
    }
    .dana-container img{width:100px;height:auto;display:block;margin-bottom:4px}
    .copy-btn{
        padding:14px 24px; 
        border-radius:6px; 
        border:none;
        background:var(--accent); 
        color:var(--white);
        font-weight:700; 
        cursor:pointer;
        width: 90%; 
        max-width: 320px;
        box-shadow: 0 4px 10px rgba(47,143,111,0.2); 
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .maps-btn{padding:10px 20px;border-radius:999px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;text-decoration:none}
    
    /* WISHES SECTION STYLES (inside thanks-inner) */
    .wishes-section{
        margin-top:40px;
        padding-top: 10px; 
        text-align: left; /* Align wishes content to the left */
        width: 100%;
        max-width: 920px;
        margin-left: auto; 
        margin-right: auto;
    }
    .wishes-header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .wishes-header h2{font-family:'Great Vibes',cursive;font-size:2rem;margin:0;color:var(--accent-dark)}
    .wishes-desc{color:var(--muted);margin-bottom:8px}

    /* Status Summary Boxes */
    .wishes-summary{
      display:flex;
      justify-content:center;
      gap:8px;
      margin-bottom: 20px;
    }
    .summary-box{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content: center; 
      padding:10px 14px;
      border-radius:10px;
      color:var(--white);
      min-width: 80px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      font-size: 0.95rem;
      height: 65px; 
    }
    .summary-box .count{
      font-weight:700;
      font-size: 1.5rem;
      margin-bottom: 2px;
      line-height: 1; 
    }

    /* Coloring based on Hadir/Tidak Hadir/Ragu */
    #count-hadir { background-color: var(--accent); } /* Hijau */
    #count-tidak-hadir { background-color: #d9534f; } /* Merah */
    #count-ragu { background-color: #f0ad4e; } /* Kuning/Oranye */
    
    /* Form */
    .wishes-form{display:block;max-width:640px;margin:10px auto 18px;padding:14px;border-radius:12px;background:rgba(255,255,255,0.9);border:1px solid rgba(47,143,111,0.06)}
    .wishes-form label{display:block;font-weight:600;margin-bottom:6px;color:var(--accent-dark)}
    .wishes-form input,.wishes-form textarea,.wishes-form select{
      width:100%;padding:10px;border-radius:10px;border:1px solid rgba(39,97,77,0.12);margin-bottom:12px;font-family:inherit;resize:vertical;
    }
    .wishes-submit{
      background:var(--accent);color:var(--white);padding:10px 14px;border-radius:999px;border:none;font-weight:700;cursor:pointer;
      box-shadow:0 6px 18px rgba(47,143,111,0.12);
    }

    /* List */
    .wishes-list{
        display:grid;
        grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
        gap:14px;
        margin-top:16px;
        text-align: left; /* Keep text left-aligned in cards */
    }
    .wish-card{background:var(--white);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(16,35,22,0.04);border:1px solid rgba(39,97,77,0.04);opacity:0;transform:translateY(8px);transition:opacity .45s ease, transform .45s ease}
    .wish-card.visible{opacity:1;transform:none}
    .wish-name{font-weight:700;color:var(--accent-dark);margin-bottom:4px}
    .wish-status{font-size:0.85rem;color:var(--muted);margin-bottom:8px}
    .wish-text{white-space:pre-wrap;color:#223;line-height:1.45;font-size:0.98rem}
    
    .wishes-footer{text-align: center; margin-bottom: 20px;}


    /* small screens */
    @media (max-width:720px){
      .cover h1{font-size:2.4rem}
      .thanks-inner{padding:18px}
      .dana-container img{width:80px} /* Reduced for mobile */
      .video-frame{max-height:70vh}
      .wishes-header h2{font-size:1.6rem}
      .wishes-list{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
      /* Status box on mobile */
      .summary-box{min-width: 60px; font-size: 0.8rem; padding: 8px 10px; height: 55px;}
      .summary-box .count{font-size: 1.2rem;}
    }
  </style>
</head>
<body>

  <main class="cover" id="cover">
    <h1>Albi & Aul</h1>
    <h2>Undangan Resepsi Pernikahan</h2>

    <div id="guestName" aria-live="polite"></div>

    <div id="countdown" role="status" aria-live="polite"></div>

    <div style="margin-top:18px;">
      <button class="btn" id="openBtn" aria-label="Buka undangan">Buka Undangan</button>
      <button class="btn" id="shareBtn" aria-label="Bagikan ke WhatsApp">Bagikan ke WhatsApp</button>
    </div>
  </main>

  <section class="video-page" id="videoPage" aria-hidden="true">
    <div class="video-frame" role="region" aria-label="Video undangan">
      <video id="weddingVideo" src="video.mp4" playsinline webkit-playsinline preload="metadata"></video>
    </div>

    <div class="video-controls" role="toolbar" aria-label="Kontrol video">
      <button id="playPauseBtn" aria-pressed="false">Pause</button>
      <button id="skipBtn" class="secondary" aria-label="Lewati video">Lewati</button>
    </div>
  </section>

  <section class="thanks-page" id="thanksPage" aria-hidden="true">
    <div class="thanks-inner" role="region" aria-label="Ucapan terima kasih dan doa">
      
      <h1>Terima Kasih</h1>
      <p>Dengan penuh rasa syukur, kami mengucapkan terima kasih atas doa dan kehadiran yang berarti bagi kami.</p>

      <div class="kado">Kirim Amplop</div>
      <div class="dana-container" role="group" aria-label="Kado Dana">
        <img src="dana.png" alt="Logo DANA" id="danaLogo">
        
        <div>A.n Albi Malik Alnnur</div>
        
        <div style="font-weight:600; margin-bottom: 8px;">088291195336</div>
        
        <button class="copy-btn" id="copyDanaBtn" aria-label="Salin nomor DANA">
            <span style="font-size:1.1em;">üóê</span> Salin Nomor
        </button>
      </div>
      <a class="maps-btn" id="mapsBtn" href="https://maps.app.goo.gl/Rt4eNJmURrbSWSZv7" target="_blank" rel="noopener">Buka Maps</a>
      
      <button class="maps-btn" id="wishesScrollBtn" type="button" style="margin-top: 12px; border-color: var(--accent); background: var(--accent); color: var(--white);">
        üíå Kirim Ucapan & Doa
      </button>
      <div class="wishes-section" id="wishesSection">
        <div class="wishes-header">
          <h2>Ucapan & Doa</h2>
          <div style="text-align:right"><small class="wishes-desc">Kirimkan doa & ucapan untuk Albi & Aul ‚Äî setiap pesan akan tersimpan aman.</small></div>
        </div>
        
        <div class="wishes-summary">
            <div class="summary-box" id="count-hadir">
                <span class="count" id="val-hadir">0</span>
                <span>Hadir</span>
            </div>
            <div class="summary-box" id="count-tidak-hadir">
                <span class="count" id="val-tidak-hadir">0</span>
                <span>Tidak Hadir</span>
            </div>
            <div class="summary-box" id="count-ragu">
                <span class="count" id="val-ragu">0</span>
                <span>Masih Ragu</span>
            </div>
        </div>
        
        <form id="wishesForm" class="wishes-form" aria-label="Form ucapan">
          <label for="w_name">Nama</label>
          <input id="w_name" name="nama" type="text" placeholder="Nama Anda" required>

          <label for="w_ucapan">Ucapan / Doa</label>
          <textarea id="w_ucapan" name="ucapan" rows="4" placeholder="Tulis ucapan atau doa..." required></textarea>

          <label for="w_kehadiran">Konfirmasi Kehadiran</label>
          <select id="w_kehadiran" name="kehadiran" required>
            <option value="">Pilih...</option>
            <option value="Hadir">Hadir</option>
            <option value="Tidak Hadir">Tidak Hadir</option>
            <option value="Masih Ragu">Masih Ragu</option>
          </select>

          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <button type="submit" class="wishes-submit">Kirim Ucapan</button>
            <div id="w_status" style="margin-left:8px;color:var(--accent-dark);font-weight:600"></div>
          </div>
        </form>

        <div id="wishesList" class="wishes-list" aria-live="polite" aria-atomic="true"></div>
      </div>
      <div class="wishes-footer" style="margin-top: 50px;">
          <h3 style="font-family:'Great Vibes',cursive; font-size: 2.2rem; margin: 0; color: var(--accent-dark);">
              Albi dan Aulia
          </h3>
      </div>
      </div>
  </section>

  <audio id="bgMusic" src="musik.mp3" preload="auto" loop></audio>

  <script>
  (function(){
    /* Config */
    const SHARE_LINK = "https://albi-aul.github.io/undangan-pernikahan/";
    const WHATSAPP_TEXT =
`üíå Undangan Pernikahan Albi & Aul üíç
Dengan penuh cinta dan rasa syukur, kami mengundang Bapak/Ibu/Saudara/i untuk hadir di hari bahagia kami.

üìç Cek lokasi lengkap dan detail acara di undangan digital kami:
${SHARE_LINK}

Kehadiran dan doa restu Anda merupakan hadiah terindah bagi kami.
‚Äî Albi & Aul`;
    const DANA_NUMBER = "088291195336"; 
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwJ8P0TShC-37Dz6pcc2xnaeAuq0KYe6jQkY6KMg9wf_w9_ithieXhW9HTSYuhehnVI7w/exec";
    const CSV_URL = "https://docs.google.com/spreadsheets/d/16u_mvksn8CaroG4ypJhqB5hUQWmRzGMU9c8w3zRZ1c0/gviz/tq?tqx=out:csv";
    
    /* DOM */
    const cover = document.getElementById('cover');
    const openBtn = document.getElementById('openBtn');
    const shareBtn = document.getElementById('shareBtn');
    const guestNameEl = document.getElementById('guestName');
    const countdownEl = document.getElementById('countdown');

    const videoPage = document.getElementById('videoPage');
    const video = document.getElementById('weddingVideo');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const skipBtn = document.getElementById('skipBtn');

    const thanksPage = document.getElementById('thanksPage');
    const wishesScrollBtn = document.getElementById('wishesScrollBtn'); // NEW SCROLL BUTTON
    const wishesSection = document.getElementById('wishesSection'); // NEW TARGET SECTION
    const bgMusic = document.getElementById('bgMusic');
    const copyDanaBtn = document.getElementById('copyDanaBtn');
    
    // Wishes Page Elements (now combined)
    const wishesForm = document.getElementById('wishesForm');
    const wishesList = document.getElementById('wishesList');
    const statusEl = document.getElementById('w_status');
    
    // Summary Counters
    const valHadir = document.getElementById('val-hadir');
    const valTidakHadir = document.getElementById('val-tidak-hadir');
    const valRagu = document.getElementById('val-ragu');

    /* Helper ‚Äî get name from ?to= query param */
    const params = new URLSearchParams(window.location.search);
    const guestParam = params.get('to') || params.get('nama') || params.get('name') || "";
    if(guestParam){
      const decoded = decodeURIComponent(guestParam).replace(/\+/g,' ');
      guestNameEl.textContent = `Kepada yang terhormat: ${decoded}`;
    } else {
      guestNameEl.textContent = "";
    }

    /* Minimal countdown (days hours minutes) */
    const target = new Date("2025-11-15T07:00:00"); // UTC offset local assumed
    function updateCountdown(){
      const now = new Date();
      let diff = Math.max(0, target - now);
      const days = Math.floor(diff / (1000*60*60*24));
      diff -= days * (1000*60*60*24);
      const hours = Math.floor(diff / (1000*60*60));
      diff -= hours * (1000*60*60);
      const minutes = Math.floor(diff / (1000*60));
      countdownEl.textContent = `${days} hari ${hours} jam ${minutes} menit lagi`;
    }
    updateCountdown();
    setInterval(updateCountdown, 60*1000);

    /* Transition helpers */
    function showVideoPage(){
      cover.style.opacity = "0";
      setTimeout(() => {
        cover.style.display = "none";
        videoPage.style.display = "flex";
        videoPage.style.opacity = "1";
      }, 500);
    }
    
    // MODIFIED: Added bgMusic.play() here
    function showThanksPage(){
      videoPage.style.opacity = "0";
      setTimeout(() => {
        videoPage.style.display = "none";
        thanksPage.style.display = "flex";
        thanksPage.style.opacity = "1";
        
        // FIX: Restart music after video stops/skips, overriding the pause listener
        bgMusic.play().catch(()=>{}); 
        
        loadWishes(); 
      }, 600);
    }
    
    /* OPEN ‚Äî start music & video together on user gesture */
    openBtn.addEventListener('click', async () => {
      try {
        await bgMusic.play();
      } catch(e){
        console.warn('bgMusic play blocked', e);
      }
      showVideoPage();
      try {
        await video.play();
      } catch(err){
        console.warn('video play blocked', err);
      }
    });

    /* SHARE to WhatsApp (cover button) */
    shareBtn.addEventListener('click', () => {
      const text = WHATSAPP_TEXT;
      const url = "https://wa.me/?text=" + encodeURIComponent(text);
      window.open(url, "_blank");
    });

    /* Play/Pause sync */
    playPauseBtn.addEventListener('click', async () => {
      if (video.paused) {
        try{ await video.play(); } catch(e){ console.warn('video play blocked', e); }
        try{ await bgMusic.play(); } catch(e){ console.warn('bgMusic play blocked', e); }
        playPauseBtn.textContent = 'Pause';
        playPauseBtn.setAttribute('aria-pressed','true');
      } else {
        video.pause();
        bgMusic.pause();
        playPauseBtn.textContent = 'Play';
        playPauseBtn.setAttribute('aria-pressed','false');
      }
    });
    video.addEventListener('play', () => {
      if (bgMusic.paused) { bgMusic.play().catch(()=>{}); }
      playPauseBtn.textContent = 'Pause';
      playPauseBtn.setAttribute('aria-pressed','true');
    });
    // The problematic listener that stops music when video stops (keep for pause button sync)
    video.addEventListener('pause', () => {
      if (!bgMusic.paused) { bgMusic.pause(); } 
      playPauseBtn.textContent = 'Play';
      playPauseBtn.setAttribute('aria-pressed','false');
    });

    /* Skip button / Video End */
    skipBtn.addEventListener('click', () => {
      try{ video.pause(); video.currentTime = video.duration || 0; } catch(e){ }
      showThanksPage();
    });
    video.addEventListener('ended', () => {
      showThanksPage();
    });

    /* Copy DANA number */
    copyDanaBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(DANA_NUMBER);
        copyDanaBtn.innerHTML = '<span style="font-size:1.1em;">‚úÖ</span> Nomor Disalin';
        setTimeout(()=>{ copyDanaBtn.innerHTML = '<span style="font-size:1.1em;">üóê</span> Salin Nomor'; }, 2200);
      } catch (err) {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = DANA_NUMBER;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          copyDanaBtn.innerHTML = '<span style="font-size:1.1em;">‚úÖ</span> Nomor Disalin';
          setTimeout(()=>{ copyDanaBtn.innerHTML = '<span style="font-size:1.1em;">üóê</span> Salin Nomor'; }, 2200);
        } catch(e){
          alert('Salin manual: ' + DANA_NUMBER);
        }
        ta.remove();
      }
    });

    /* Scroll to Wishes Button Handler */
    wishesScrollBtn.addEventListener('click', () => {
        wishesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });


    /* Wishes Logic */
    
    // Submit handler to Apps Script
    wishesForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const fd = new FormData(form);
      statusEl.textContent = 'Mengirim...';
      try {
        const res = await fetch(APPS_SCRIPT_URL, { method: 'POST', body: fd });
        const json = await res.json();
        if(json && json.status === 'success'){
          statusEl.textContent = '‚úÖ Terima kasih! Ucapan dikirim.';
          form.reset();
          // Reload wishes after successful submit
          setTimeout(loadWishes, 900); 
        } else {
          statusEl.textContent = '‚ö†Ô∏è Gagal mengirim. Silakan coba lagi.';
        }
      } catch (err){
        statusEl.textContent = '‚ùå Koneksi gagal.';
      }
      setTimeout(()=>{ statusEl.textContent = ''; }, 2400);
    });

    // Fetch CSV and render cards + Count Status
    async function loadWishes(){
      // Reset counts
      let countHadir = 0;
      let countTidakHadir = 0;
      let countRagu = 0;

      try {
        const res = await fetch(CSV_URL);
        const txt = await res.text();
        const rows = csvToArray(txt);
        // rows expected: header row then data rows
        const dataRows = rows.slice(1).filter(r=>r.length >= 3);
        // clear list
        wishesList.innerHTML = '';
        
        // Render and Count
        dataRows.reverse().forEach((r, idx) => { // Tampilkan yang terbaru di atas (reverse)
          const [nama, ucapan, kehadiran, waktu] = r;
          
          // Count Status
          const status = kehadiran ? kehadiran.toLowerCase() : '';
          if (status.includes('hadir')) {
              countHadir++;
          } else if (status.includes('tidak hadir')) {
              countTidakHadir++;
          } else if (status.includes('ragu')) {
              countRagu++;
          }

          // Create Card
          const card = document.createElement('article');
          card.className = 'wish-card';
          // Tambahkan ikon centang jika statusnya 'Hadir' 
          const statusIcon = status.includes('hadir') ? '<span style="color:var(--accent); margin-right:4px;">‚úî</span>' : '';
          
          card.innerHTML = `<div class="wish-name">${statusIcon}${escapeHtml(nama || 'Tamu')}</div>
                            <div class="wish-status">${escapeHtml(kehadiran || '')}</div>
                            <div class="wish-text">${escapeHtml(ucapan || '')}</div>`;
          wishesList.appendChild(card);
          
          // Animate in
          setTimeout(()=>{ card.classList.add('visible'); }, 80 + idx*80);
        });
        
        // Update Summary Display
        if (valHadir) valHadir.textContent = countHadir;
        if (valTidakHadir) valTidakHadir.textContent = countTidakHadir;
        if (valRagu) valRagu.textContent = countRagu;

      } catch (err){
        wishesList.innerHTML = '<div style="color:var(--muted)">Gagal memuat ucapan. Periksa koneksi atau akses publik spreadsheet.</div>';
        if (valHadir) valHadir.textContent = '0';
        if (valTidakHadir) valTidakHadir.textContent = '0';
        if (valRagu) valRagu.textContent = '0';
      }
    }

    // CSV parser (simple)
    function csvToArray(str){
      const rows = [];
      const lines = str.split(/\r?\n/).filter(Boolean);
      for(const line of lines){
        const cols = [];
        let cur = '', inQ=false;
        for(let i=0;i<line.length;i++){
          const ch = line[i];
          if(ch === '"' ){ inQ = !inQ; continue; }
          if(ch === ',' && !inQ){ cols.push(cur); cur=''; continue; }
          cur += ch;
        }
        cols.push(cur);
        rows.push(cols.map(c=>c.trim().replace(/^"(.*)"$/, '$1')));
      }
      return rows;
    }

    function escapeHtml(s){
      return String(s).replace(/&/g,'&').replace(/</g,'<').replace(/>/g,'>');
    }
  })();
  </script>

</body>
</html>